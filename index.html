<!doctype html><html><head><meta charset=utf-8><title>Location RPG</title><link rel="shortcut icon" href=data:image/x-icon;, type=image/x-icon><meta name=viewport content="width=device-width,initial-scale=1"><style>html{scroll-behavior:smooth;font-size:1.2em}body{background-color:#000;color:#d4aa96;font-family:sans-serif}p{animation:fadein .5s;margin:0}p::before{display:block;content:"";height:2px;background-color:#29201c;margin:30px 40% 30px 0}p:first-child::before{opacity:0}@keyframes fadein{from{opacity:0}to{opacity:1}}@keyframes fadeout{from{opacity:1}to{opacity:0}}.fade{animation:fadeout .5s;animation-fill-mode:both}#feed{max-width:500px;margin:auto;padding-bottom:33.33vh;user-select:none}ul{list-style:none;margin-left:0;padding-left:0}li{padding-left:1em;text-indent:-1em;margin:20px 0}li:before{content:"Â»";padding-right:15px}.selected{background-color:#272727}button{font-size:2em;display:block;margin:30vh auto 0}</style></head><body><button id=play>Play</button><div id=feed></div><script defer>
(function(){const g=new AudioContext;class k{play(){}}
class l extends k{constructor(a,b,c,d,e){super();this.pitch=a;this.gain=b;this.type=c;this.attack=d;this.release=e}play(a){g.resume();const b=g.createGain();var c=g.currentTime+this.attack;const d=c+this.release;b.gain.value=0;b.gain.linearRampToValueAtTime(.5*this.gain,c);b.gain.linearRampToValueAtTime(0,d);b.connect(g.destination);c=g.createBiquadFilter();c.type="lowpass";c.frequency.value=550;c.connect(b);const e=g.createOscillator();e.type=this.type;e.frequency.value=440*Math.pow(2,(this.pitch-
69)/12);e.start();e.stop(d);e.addEventListener("ended",()=>{b.disconnect();a&&a()});e.connect(c)}}var n=new l(66,1,"square",.01,.1),p=new l(63,.2,"square",.01,.05),q=new l(71,1,"square",.01,.3),r=[73,75,76,78,80,82,83,85,87,88].map(a=>new l(a,1,"sawtooth",.1,.2));function t(){window.addEventListener("pointerdown",()=>{n.play();u=setTimeout(()=>{const a=v[v.length-1];void 0!==a&&a.l();u=null},400)});window.addEventListener("pointerup",()=>{p.play();if(null!==u){clearTimeout(u);var a=v[v.length-1];void 0!==a&&a.i()}})}
function w(){var a=x.shift();if(void 0!==a){a.j();var b=a.element;y.appendChild(b);v.push(a);location.hash=b.id;a=v.length-40;for(b=0;b<a;b++){const c=v.shift(),d=c.element;d.classList.add("fade");d.addEventListener("animationend",()=>{if(!z.has(c)){z.add(c);cancelAnimationFrame(A);let e=3;function f(){console.log("Frame: "+A);window.scrollY+window.innerHeight>=document.body.scrollHeight?e--:e=3;0>=e?(z.forEach(m=>{let h;return null==(h=m.element.parentElement)?void 0:h.removeChild(m.element)}),z.clear()):
A=requestAnimationFrame(f)}A=requestAnimationFrame(f)}})}}}class B{constructor(){this.element=document.createElement("p");this.element.id=String(C++)}j(){}i(){}l(){}}function E(a,b){speechSynthesis.cancel();let c=null;for(const d of a)c=new SpeechSynthesisUtterance("string"===typeof d?d:d.text),speechSynthesis.speak(c);null!==c&&void 0!==b&&c.addEventListener("end",b)}
function F(a){const b=document.createDocumentFragment();b.append(document.createTextNode(a.map(c=>"string"===typeof c?c:c.text).join("")));return b}class G{constructor(a){this.text=a}}class H extends B{constructor(a){super();this.content=a;this.m=!1}i(){this.m=!0;w()}j(){this.element.appendChild(F(this.content));E(this.content,()=>{this.m||w()})}}
function I(a){a.g.forEach(d=>d[2].classList.remove("selected"));const [b,,c]=a.g[a.selected];c.classList.add("selected");r[a.selected%r.length].play(()=>E(b))}function J(a,...b){const c=[],d=[];for(const e of b)"function"===typeof e?d.push(e):c.push(e);a.g.push([c,d,document.createElement("li")]);return a}
class K extends B{constructor(){super();this.list=document.createElement("ul");this.g=[];this.selected=0;this.element.appendChild(this.list);this.h=!1}j(){this.g.forEach(a=>{a[2].appendChild(F(a[0]))});this.g.forEach(a=>this.list.appendChild(a[2]));I(this)}i(){speechSynthesis.cancel();this.h||(this.selected=(this.selected+1)%this.g.length);I(this)}l(){const a=this.g[this.selected];speechSynthesis.cancel();q.play(()=>{this.h||a[1].forEach(b=>b());this.h=!0;w()})}}const x=[],v=[],z=new Set,y=document.getElementById("feed");
let C=0,A=-1,u=null;function L(...a){a=new H(a.map(b=>"string"===typeof b?new G(b):b));x.push(a);return a}function M(){const a=new K;x.push(a);return a};const N=document.getElementById("play");
N.addEventListener("click",()=>{function a(){L("Fetching your location...");navigator.geolocation.getCurrentPosition(d=>{const e=d.coords;L("Your location is "+d.coords.latitude+" degrees latitude and "+d.coords.longitude+" degrees longitude.");L("Fetching local map data...");fetch("https://lz4.overpass-api.de/api/interpreter?data=[out:json];"+`(nwr(around:${100},${e.latitude},${e.longitude});>;)->.a;`+`nwr(around:${200},${e.latitude},${e.longitude}).a;`+"out;").then(f=>f.text()).then(f=>{L("Map data is "+
f.length/1E3+" kilobytes.");f=JSON.parse(f);console.log(f);f=f.elements;const m=new Set;f.forEach(h=>{(h=h.tags)&&Object.entries(h).forEach(D=>{m.add((D[0]+" = "+D[1]).replace("_"," "))})});L(`Found ${f.length} elements. Listing nearby tags.`);[...m].sort().forEach(h=>L(h))}).catch(f=>{console.log(f);L("There was an error processing map data: "+f.message)})},d=>{L("There was an error accessing your location: "+d.message)},{enableHighAccuracy:!0})}function b(){L("Welcome to the game.");J(M(),"Press and hold anywhere to continue.",
()=>{L("Great! Are you ready to move on?");J(J(M(),"No, take me back. Press anywhere to go to the next option.",()=>{L("Let's try again.");b()}),"Yes, let's continue. Press and hold to confirm this option.",()=>{a()})})}let c;null==(c=N.parentElement)||c.removeChild(N);t();b();w()});}).call(this);
</script></body></html>